<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./index.css" />
  <link rel="stylesheet" type="text/css" href="./global.css" />
  <title>Новости</title>
  <link rel="icon" href="./icons/web-favicon.svg" type="image/x-icon" />
</head>

<body>
  <div id="header" class="header">
  </div>
  <div class="main_block">
    <div class="content">
      <div class='title'>
        <h1>
          Заголовок
        </h1>
        <h4>
          Подзаголовок
        </h4>
        <p>
          The brutal leader of Null Sector will stop at nothing to see his vision for the world realized. Ramattra was
          never designed to co-exist with humanity. The Ravager omnic series was created early in the Omnic Crisis, part
          of a commander class of omnics whose role was to guide units into combat and adapt various strategic protocols
          to battlefield condition changes in real time.
        </p>
      </div>
      <img width="483px" height="483px" src="/icons/personage.png" />
    </div>
    <div class="news">
      <h1>
        Новости
      </h1>
    </div>
  </div>
  <script src="./js/index.js"></script>
  <script src="./js/token.js"></script>
  <script type="text/javascript" src="./js/homeNews/homeNews.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script>
    //Html элемент для показа новостей
    const newsTemplate = `
<div class="news_block">
  <div class="new">
    <div class="news_content">
      <h4 class="title_new"></h4>
      <p class="description_new"></p>
    </div>
    <div class="date_new">
      <p></p>
      <p></p>
    </div>
  </div>
  <img class="image_new" width="468px" height="294px" />
</div>
`;
    document.body.style.display = 'block';
    //Рендер новостей
    fetch(`${base_url}news/?limit=5&offset=0`, {
      method: 'GET',
      headers: csrfToken
    }).then(res => res.json()).then(data => {
      const newsContainer = document.querySelector('.news');
      //Форматирование даты
      data.results.forEach(newsItem => {
        const dateTime = new Date(newsItem.created_at);
        const day = dateTime.getDate();
        const month = dateTime.toLocaleString('ru-RU', { month: 'short' });
        const year = dateTime.getFullYear();
        const formattedDate = `${day} ${month}. ${year}`;
        const timeWithoutSeconds = dateTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const newsBlock = document.createElement('div');
        newsBlock.innerHTML = newsTemplate;
        const titleElement = newsBlock.querySelector('.title_new');
        titleElement.textContent = newsItem.title;
        const descriptionElement = newsBlock.querySelector('.description_new');
        descriptionElement.textContent = newsItem.content;
        const dateElements = newsBlock.querySelectorAll('.date_new p');
        dateElements[0].textContent = timeWithoutSeconds;
        dateElements[1].textContent = formattedDate;
        const imageElement = newsBlock.querySelector('.image_new');
        //Проверка на то, есть ли картинка или нет, если нет, то ее ссылка будет /icons/Image.png
        if (newsItem.image) {
          imageElement.src = newsItem.image || '/icons/Image.png';
        }
        else {
          imageElement.src = '/icons/Image.png';
        }
        newsBlock.style.display = 'flex';
        newsBlock.style.paddingTop = '24px';
        newsBlock.style.width = '100%';
        newsBlock.style.justifyContent = 'space-between';
        newsContainer.appendChild(newsBlock);
      });
    })
  </script>
</body>

</html>