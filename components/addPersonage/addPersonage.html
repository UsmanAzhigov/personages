<link rel="stylesheet" href="./addPersonage.css">
<link rel="stylesheet" href="/global.css">
<div class="modal">
  <div class="content">
    <div class="addPersonage_header">
      <p class="addPersonage_text">Создать карточку героя</p>
      <img class="close" width="32px" height="32px" src="/icons/closeIcon.svg" id="close-personages-modal" />
    </div>
    <div class="addPersonage_block">
      <div class="add_image">
        <p class="add_image_text">Портрет персонажа</p>
        <div class="image_block">
          <img class="add_image" width="90px" height="80px" src="/icons/addImageSvg.svg" />
          <button class="btn">
            <input type="file" class="add-avatar" id="add-avatar-input" />
            <img width="18px" height="16px" src="/icons/uploadImage.svg" /> Загрузить фото
          </button>
          <p class="order_text">Или перетащите файл сюда</p>
        </div>
      </div>
      <div class="addPersonage_form">
        <div class="namePersonage">
          <label>Имя</label>
          <input value="" id="name" type="text" placeholder="Ваш заголовок" />
          <label id="name-error-label" for="" class="input-error-label none"></label>
        </div>
        <label class="period_label">Период активности</label>
        <div class="period">
          <div class="start">
            <input id="period" type="date" placeholder="Начало" />
          </div>
          <img width="12px" height="24px" src="/icons/minus.svg" />
          <input id="period" type="date" placeholder="Конец" />
          <label id="period-error-label" for="" class="input-error-label none"></label>
        </div>
        <div class="place">
          <label>Место</label>
          <input id="place" type="text" placeholder="Ваш текст..." />
          <label id="place-error-label" for="" class="input-error-label none"></label>
        </div>
        <div class="additional_information">
          <label>Дополнительная информация</label>
          <input id="additional_information" type="text" placeholder="Ваш текст..." />
          <label id="additional_information-error-label" for="" class="input-error-label none"></label>
        </div>
        <div class="fraction">
          <input id="fraction" type="checkbox" />
          <p>Отображать фракцию персонажа</p>
        </div>
      </div>
    </div>
    <div class="btn_block">
      <button class="open_mail" id="cancelPersonageBtn">Сбросить</button>
      <button class="btn" id="addPersonageBtn">Сохранить</button>
    </div>
  </div>
</div>
<script src="/js/api.js"></script>
<script src="/js/index.js"></script>
<script src="/js/libs.js"></script>
<script>
  const savePersonageBtn = document.querySelector('#addPersonageBtn');
  const cancelPersonageBtn = document.querySelector('#cancelPersonageBtn');
  const nameInput = document.querySelector('#name');
  const activePeriod = document.querySelector('.start input');
  const endPeriod = document.querySelector('#period');
  const placeInput = document.querySelector('#place');
  const additionalInformationInput = document.querySelector('#additional_information');
  const fractionInput = document.querySelector('#fraction');
  const imageBlock = document.querySelector('.image_block');
  const addAvatarInput = document.querySelector('#add-avatar-input');

  // Функция для загрузки изображения
  function uploadImage(event) {
    const selectedFile = event.target.files[0];
    const reader = new FileReader();

    reader.onload = () => {
      const image = document.createElement('img');
      image.classList.add('img');
      image.src = reader.result;
      imageBlock.innerHTML = '';
      imageBlock.appendChild(image);
    };

    reader.readAsDataURL(selectedFile);
  }

  // Привязка функции uploadImage к событию изменения input[type="file"]
  addAvatarInput.addEventListener('change', uploadImage);

  nameInput.addEventListener('input', (event) => {
    savePersonageBtn.disabled = event.target.value.trim() === ''
    cancelPersonageBtn.disabled = event.target.value.trim() === ''
  });

  savePersonageBtn.disabled = true
  cancelPersonageBtn.disabled = true

  savePersonageBtn.style.width = '111px'
  cancelPersonageBtn.style.width = '111px'
  const closeModalBtn = document.querySelector('#close-personages-modal');


  function closeModal() {
    document.querySelector('#addPersonageModal').innerHTML = '';
    document.querySelector('#addPersonageModal').style.display = 'none';
  }

  function savePersonage() {
    try {
      const formData = new FormData();
      formData.append('name', nameInput.value);
      formData.append('active_start_date', activePeriod.value);
      formData.append('active_end_date', endPeriod.value);
      formData.append('place', placeInput.value);
      formData.append('show_public', 1);
      formData.append('show_fraction', fractionInput.value);
      window.api.createPersonas(formData).then(res => {
        if (res.success) {
          alert('Пользователь создан');
          window.location.reload();
        }
      })
    } catch (error) {
      console.log(error)
    }
  }

  savePersonageBtn.addEventListener('click', savePersonage);
  closeModalBtn.addEventListener('click', closeModal);
</script>